STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 1  Assembler
                                               d:\stm8\dbg1\main.asm

   1                         stm8/     
   2                         
   0  000000                                 #include "mapping.inc"
   1                                                          ;-------------------------------
                                                                ;-----------------------
   2                                                          ; SEGMENT MAPPING FILE 
                                                                ;AUTOMATICALLY GENERATED BY 
                                                                ;STVD
   3                                                          ; SHOULD NOT BE MANUALLY 
                                                                ;MODIFIED.
   4                                                          ; CHANGES WILL BE LOST WHEN FILE
                                                                ; IS REGENERATED.
   5                                                          ;-------------------------------
                                                                ;-----------------------
   6  000000                                 #define  RAM0 1
   7  000000                                 #define  ram0_segment_start 0
   8  000000                                 #define  ram0_segment_end FF
   9  000000                                 #define  RAM1 1
  10  000000                                 #define  ram1_segment_start 100
  11  000000                                 #define  ram1_segment_end 1FF
  12  000000                                 #define  stack_segment_start 200
  13  000000                                 #define  stack_segment_end 3FF
<END_OF_INCLUSION>
   0  000000                                 #include "stm8s003f3.inc"
   1                         ;----STM8S003F3 peripherial define file
   2                         ;--Registers of the MCU:
   3                                   
   4                                                          ;---CLK-----
   5  000000                                 #define  CLK_ICKR      $50C0;
   6  000000                                 #define  CLK_ECKR      $50C1;
   7  000000                                 #define  CLK_CMSR      $50C3;
   8  000000                                 #define  CLK_SWR       $50C4;
   9  000000                                 #define  CLK_SWCR      $50C5;
  10  000000                                 #define  CLK_CKDIVR    $50C6;
  11  000000                                 #define  CLK_PCKENR1    $50C7;
  12  000000                                 #define  CLK_CSSR       $50C8;
  13  000000                                 #define  CLK_CCOR       $50C9;
  14  000000                                 #define  CLK_PCKENR2    $50CA;
  15                                   
  16  000000                                 #define  HSERDY        #$02
  17  000000                                 #define  HSEEN         #$01
  18                                   
  19  000000                                 #define  SWIF    #$08 
  20  000000                                 #define  SWIEN         #$04
  21  000000                                 #define  SWEN          #$02
  22  000000                                 #define  SWBSY   #$01
  23                                   
  24  000000                                 #define  HSIDIV_1 #$00
  25  000000                                 #define  HSIDIV_2 #$08
  26  000000                                 #define  HSIDIV_4 #$10
  27  000000                                 #define  HSIDIV_8 #$18
  28                                   
  29  000000                                 #define  CPUDIV_1 #$00
  30  000000                                 #define  CPUDIV_2 #$01
  31  000000                                 #define  CPUDIV_4 #$02
  32  000000                                 #define  CPUDIV_8 #$03
  33  000000                                 #define  CPUDIV_16 #$04
  34  000000                                 #define  CPUDIV_32 #$05
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 2  Assembler
                                               d:\stm8\dbg1\main.asm

  35  000000                                 #define  CPUDIV_64 #$06
  36  000000                                 #define  CPUDIV_128 #$07
  37                                                          ;-------ITC------
  38  000000                                 #define  EXTI_CR1  $50A0  ;
  39  000000                                 #define  EXTI_CR2  $50A1  ;
  40                                                          ;----FLASH-------
  41  000000                                 #define  FLASH_CR1 $505A  ;
  42  000000                                 #define  FLASH_CR2 $505B  ;
  43  000000                                 #define  LASH_NCR2 $505C  ;
  44  000000                                 #define  FLASH_FPR $505D  ;
  45  000000                                 #define  FLASH _NFPR $505E  ; 	
  46  000000                                 #define  _NFPR $505E _IAPSR $505F  ;
  47                                                          ;--------PORT A-----
  48  000000                                 #define  PA_ODR        $5000;
  49  000000                                 #define  PA_IDR        $5001;
  50  000000                                 #define  PA_DDR        $5002;
  51  000000                                 #define  PA_CR1        $5003;
  52  000000                                 #define  PA_CR2  $5004  ;
  53                                                          ;--------PORT B------
  54  000000                                 #define  PB_ODR        $5005;
  55  000000                                 #define  PB_IDR        $5006;
  56  000000                                 #define  PB_DDR        $5007;
  57  000000                                 #define  PB_CR1        $5008;
  58  000000                                 #define  PB_CR2        $5009;
  59                                                          ;---------PORT  C-----
  60  000000                                 #define  PC_ODR        $500A;
  61  000000                                 #define  PC_IDR        $500B;
  62  000000                                 #define  PC_DDR        $500C;
  63  000000                                 #define  PC_CR1        $500D;
  64  000000                                 #define  PC_CR2        $500E;
  65                                   
  66                                                          ;----PORT D-------
  67  000000                                 #define  PD_ODR        $500F;
  68  000000                                 #define  PD_IDR        $5010;
  69  000000                                 #define  PD_DDR        $5011;
  70  000000                                 #define  PD_CR1        $5012;
  71  000000                                 #define  PD_CR2        $5013;
  72                                                          ;--------PORT E-------
  73  000000                                 #define  PE_ODR        $5014;
  74  000000                                 #define  PE_IDR        $5015;
  75  000000                                 #define  PE_DDR        $5016;
  76  000000                                 #define  PE_CR1        $5017;
  77  000000                                 #define  PE_CR2        $5018;
  78                                                          ;---------PORT F------
  79  000000                                 #define  PF_ODR        $5019;
  80  000000                                 #define  PF_IDR        $501A;
  81  000000                                 #define  PF_DDR        $501B;
  82  000000                                 #define  PF_CR1        $501C;
  83  000000                                 #define  PF_CR2        $501D;
  84                                                          ;------ITC---------
  85  000000                                 #define  $50A0 $50A0   ;
  86  000000                                 #define  $50A1 $50A1   ;
  87                                                          ;--------TIM 1----------
  88  000000                                 #define  TIM1_CR1  $5250  ;
  89  000000                                 #define  TIM1_CR2  $5251  ;
  90  000000                                 #define  TIM1_SMCR $5252  ;
  91  000000                                 #define  TIM1_ETR  $5253  ;
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 3  Assembler
                                               d:\stm8\dbg1\main.asm

  92  000000                                 #define  TIM1_IER  $5254  ;
  93  000000                                 #define  TIM1_SR1  $5255  ;
  94  000000                                 #define  TIM1_SR2  $5256  ;
  95  000000                                 #define  TIM1_EGR  $5257  ;
  96  000000                                 #define  TIM1_CCMR1 $5258  ;
  97  000000                                 #define  TIM1_CCMR2 $5259  ;
  98  000000                                 #define  TIM1_CCMR3 $525A  ;
  99  000000                                 #define  TIM1_CCMR4  $525B  ;
 100  000000                                 #define  TIM1_CCER1 $525C  ;
 101  000000                                 #define  TIM1_CCER2 $525D  ;
 102  000000                                 #define  TIM1_CNTRH $525E  ;
 103  000000                                 #define  TIM1_CNTRL  $255f  ;
 104  000000                                 #define  TIM1_PSCRH  $5260  ;
 105  000000                                 #define  TIM1_PSCRL $5261  ;
 106  000000                                 #define  TIM1_ARRH  $5262  ;
 107  000000                                 #define  TIM1_ARRL  $5263  ;
 108  000000                                 #define  TIM1_RCR   $5264  ;
 109  000000                                 #define  TIM1_CCR1H $5265  ;
 110  000000                                 #define  TIM1_CCR1L $5266  ;
 111  000000                                 #define  TIM1_CCR2H $5267  ;
 112  000000                                 #define  TIM1_CCR2L $5268  ;
 113  000000                                 #define  TIM1_CCR3H $5269  ;
 114  000000                                 #define  TIM1_CCR3L $526A  ;
 115  000000                                 #define  TIM1_CCR4H  $526B  ;
 116  000000                                 #define  TIM1_CCR4L $526C  ;
 117  000000                                 #define  TIM1_BKR   $526D  ;
 118  000000                                 #define  TIM1_DTR   $526E  ;
 119  000000                                 #define  TIM1_OISR  $526F  ;
 120                                   
 121  000000                                 #define  TIM_CR1_CENTER_ALINGN_1 #$20
 122  000000                                 #define  TIM_CR1_CENTER_ALINGN_2 #$40
 123  000000                                 #define  TIM_CR1_CENTER_ALINGN_3 #$60
 124  000000                                 #define  TIM_CR1_COUNTS_UP #$00
 125  000000                                 #define  TIM_CR1_COUNTS_DOWN #$10
 126  000000                                 #define  TIM_CR1_PRELOAD #$80
 127  000000                                 #define  TIM_CCMR_ACTIVE_ON_MATCH #$10
 128  000000                                 #define  TIM_CCMR_INACTIVE_ON_MATCH #$20
 129  000000                                 #define  TIM_CCMR_TOGGLE   #$30
 130  000000                                 #define  TIM_CCMR_FORCE_INACTIVE #$40 
 131  000000                                 #define  TIM_CCMR_FORCE_ACTIVE   #$50
 132                                                          ;-------------SPI----------
 133  000000                                 #define  SPI_CR1  $5200  ;
 134  000000                                 #define  SPI_CR2 $5201  ;
 135  000000                                 #define  SPI_ICR  $5202  ;
 136  000000                                 #define  SPI_SR        $5203;
 137  000000                                 #define  SPI_DR        $5204;
 138  000000                                 #define  SPI_CRCPR     $5205;
 139  000000                                 #define  SPI_RXCRCR    $5206;
 140  000000                                 #define  SPI_TXCRCR    $5207;
 141                                                          ;---------------I2C----------
 142  000000                                 #define  I2C_CR1       $5210;
 143  000000                                 #define  I2C_CR2       $5211;
 144  000000                                 #define  I2C_FREQR     $5212;
 145  000000                                 #define  I2C_OARL      $5213;
 146  000000                                 #define  I2C_OARH      $5214;
 147  000000                                 #define  I2C_DR        $5216;
 148  000000                                 #define  I2C_SR1       $5217;
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 4  Assembler
                                               d:\stm8\dbg1\main.asm

 149  000000                                 #define  I2C_SR2       $5218;
 150  000000                                 #define  I2C_SR3       $5219;
 151  000000                                 #define  I2C_ITR       $521A;
 152  000000                                 #define  I2C_CCRL      $521B;
 153  000000                                 #define  I2C_CCRH      $521C;
 154  000000                                 #define  I2C_TRISER    $521D;
 155  000000                                 #define  I2C_PECR      $521E;
 156                                                          ;------------UART--------------
 157  000000                                 #define  UART1_SR      $5230;
 158  000000                                 #define  UART1_DR      $5231;
 159  000000                                 #define  UART1_BRR1    $5232;
 160  000000                                 #define  UART1_BRR2    $5233;
 161  000000                                 #define  UART1_CR1     $5234;
 162  000000                                 #define  UART1_CR2     $5235;
 163  000000                                 #define  UART1_CR3     $5236;
 164  000000                                 #define  UART1_CR4     $5237;
 165  000000                                 #define  UART1_CR5     $5238;
 166  000000                                 #define  UART1_GTR     $5239;
 167  000000                                 #define  UART1_PSCR    $523A;
 168                                                          ;----------TIM4----------------
 169  000000                                 #define  TIM4_CR1      $5340;
 170  000000                                 #define  TIM4_IER      $5343;
 171  000000                                 #define  TIM4_SR       $5344;
 172  000000                                 #define  TIM4_EGR      $5345;
 173  000000                                 #define  TIM4_CNTR     $5346;
 174  000000                                 #define  TIM4_PSCR     $5347;
 175  000000                                 #define  TIM4_ARR      $5348;
 176                                                          ;---------ADC1-----------------
 177                                   
 178  000000                                 #define  ADC_CSR       $5400;
 179  000000                                 #define  ADC_CR1       $5401;
 180  000000                                 #define  ADC_CR2       $5402;
 181  000000                                 #define  ADC_CR3       $5403;
 182  000000                                 #define  ADC_DRH       $5404;
 183  000000                                 #define  ADC_DRL       $5405;
 184  000000                                 #define  ADC_TDRH      $5406;
 185  000000                                 #define  ADC_TDRL      $5407;
 186  000000                                 #define  ADC_HTRH      $5408;
 187  000000                                 #define  ADC_HTRL      $5409;
 188  000000                                 #define  ADC_LTRH      $540A;
 189  000000                                 #define  ADC_LTRL      $540B;
 190  000000                                 #define  ADC_AWSRH     $540C;
 191  000000                                 #define  ADC_AWSRL     $540D;
 192  000000                                 #define  ADC_AWCRH     $540E;
 193  000000                                 #define  ADC_AWCRL     $540F;
 194                                                          ;;buffers
 195  000000                                 #define  ADC_DB0RH     $53E0;
 196  000000                                 #define  ADC_DB0RL     $53E1;
 197  000000                                 #define  ADC_DB1RH     $53E2;
 198  000000                                 #define  ADC_DB1RL     $53E3;
 199  000000                                 #define  ADC_DB2RH     $53E4;
 200  000000                                 #define  ADC_DB2RL     $53E5;
 201  000000                                 #define  ADC_DB3RH     $53E6;
 202  000000                                 #define  ADC_DB3RL     $53E7;
 203  000000                                 #define  ADC_DB4RH     $53E8;
 204  000000                                 #define  ADC_DB4RL     $53E9;
 205  000000                                 #define  ADC_DB5RH     $53EA;
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 5  Assembler
                                               d:\stm8\dbg1\main.asm

 206  000000                                 #define  ADC_DB5RL     $53EB;
 207  000000                                 #define  ADC_DB6RH     $53EC;
 208  000000                                 #define  ADC_DB6RL     $53ED;
 209  000000                                 #define  ADC_DB7RH     $53EC;
 210  000000                                 #define  ADC_DB7RL     $53ED;
 211  000000                                 #define  ADC_DB8RH     $53EC;
 212  000000                                 #define  ADC_DB8RL     $53ED;
 213                                   
 214                                   
 215                                                          ;----------TIM2----------
 216  000000                                 #define  TIM2_CR1      $5300;
 217  000000                                 #define  TIM2_IER      $5303;
 218  000000                                 #define  TIM2_SR1      $5304;
 219  000000                                 #define  TIM2_SR2      $5305;
 220  000000                                 #define  TIM2_EGR      $5306;
 221  000000                                 #define  TIM2_CCMR1    $5307;
 222  000000                                 #define  TIM2_CCMR2    $5308;
 223  000000                                 #define  TIM2_CCMR3    $5309;
 224  000000                                 #define  TIM2_CCER1    $530A;
 225  000000                                 #define  TIM2_CCER2    $530B;
 226  000000                                 #define  TIM2_CNTRH    $530C;
 227  000000                                 #define  TIM2_CNTRL      $530D  ;
 228  000000                                 #define  TIM2_PSCR     $530E;
 229  000000                                 #define  TIM2_ARRH     $530F;
 230  000000                                 #define  TIM2_ARRL     $5310;
 231  000000                                 #define  TIM2_CCR1H    $5311;
 232  000000                                 #define  TIM2_CCR1L    $5312;
 233  000000                                 #define  TIM2_CCR2H      $5313  ;
 234  000000                                 #define  TIM2_CCR2L    $5314;
 235  000000                                 #define  TIM2_CCR3H    $5315;
 236  000000                                 #define  TIM2_CCR3L    $5316;
 237                                   
 238                                   
<END_OF_INCLUSION>
   5                         
   6                                   segment  'rom'     
   7                         main.l    
   8                                                          ; initialize SP
   9  008080   AE03FF                        ldw      X,#stack_end
  10  008083   94                            ldw      SP,X
  11                         
  12  008084                                 #ifdef   1             
  13                                                          ; clear RAM0
  14  000000                       ram0_start.b  EQU      $0
  15  0000FF                       ram0_end.b  EQU      $FF
  16  008084   AE0000                        ldw      X,#ram0_start
  17                         clear_ram0.l  
  18  008087   7F                            clr      (X)
  19  008088   5C                            incw     X
  20  008089   A300FF                        cpw      X,#ram0_end   
  21  00808C   23F9                          jrule    clear_ram0
  22  00808E                                 #endif   
  23                         
  24  00808E                                 #ifdef   1
  25                                                          ; clear RAM1
  26  000100                       ram1_start.w  EQU      $100
  27  0001FF                       ram1_end.w  EQU      $1FF          
  28  00808E   AE0100                        ldw      X,#ram1_start
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 6  Assembler
                                               d:\stm8\dbg1\main.asm

  29                         clear_ram1.l  
  30  008091   7F                            clr      (X)
  31  008092   5C                            incw     X
  32  008093   A301FF                        cpw      X,#ram1_end   
  33  008096   23F9                          jrule    clear_ram1
  34  008098                                 #endif   
  35                         
  36                                                          ; clear stack
  37  000200                       stack_start.w  EQU      $200
  38  0003FF                       stack_end.w  EQU      $3FF
  39  008098   AE0200                        ldw      X,#stack_start
  40                         clear_stack.l  
  41  00809B   7F                            clr      (X)
  42  00809C   5C                            incw     X
  43  00809D   A303FF                        cpw      X,#stack_end  
  44  0080A0   23F9                          jrule    clear_stack
  45                         ;______________________________________
  46                         ;  _   _ ___  ___ _ __   _ __ ___   __ _(_)_ __  
  47                         ; | | | / __|/ _ \ '__| | '_ ` _ \ / _` | | '_ \ 
  48                         ; | |_| \__ \  __/ |    | | | | | | (_| | | | | |
  49                         ;  \__,_|___/\___|_|    |_| |_| |_|\__,_|_|_| |_|
  50  0080A2   A600                          LD       A, #$00
  51  0080A4   88                            PUSH     A
  52  0080A5   CD82EC                        CALL     clkSetHsiDivider
  53  0080A8   84                            POP      A
  54  0080A9   A6FF                          LD       A, #$FF
  55  0080AB   C750C7                        LD       $50C7, A
  56  0080AE   A68A                          LD       A, #$8A
  57  0080B0   C750CA                        LD       $50CA, A
  58                                                          ;--turn on quartz
  59  0080B3   CD82CE                        CALL     clkSwitchToCrystal
  60                                   
  61                                                          ;--PC6-output 
  62  0080B6   A6D8                          LD       A, #$D8       ; 3,4,6,7  
  63  0080B8   C7500C                        LD       $500C, A
  64  0080BB   C7500D                        LD       $500D, A
  65  0080BE   C7500E                        LD       $500E, A
  66                                                          ;--PA3
  67  0080C1   A600                          LD       A, #$00       ;  
  68  0080C3   C75002                        LD       $5002, A
  69  0080C6   C75003                        LD       $5003, A
  70  0080C9   C75004                        LD       $5004, A
  71                                                          ;--D
  72  0080CC   A600                          LD       A, #$00       ;  
  73  0080CE   C75011                        LD       $5011, A
  74  0080D1   C75012                        LD       $5012, A
  75  0080D4   C75013                        LD       $5013, A
  76                                   
  77                         
  78                                   
  79                                                          ;@presc16,  
  80                                                          ;@base16, -> base of counter, 
                                                                ;ARRL
  81                                                          ;@comp16, -> pulse width, CCR1 
                                                                ;content
  82                                                          ;@mode8,  -> (CCMR) : $60 
                                                                ;PWM_MODE1
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 7  Assembler
                                               d:\stm8\dbg1\main.asm

  83                                                          ;$70 iPWM_MODE2
  84                                                          ;additional:  $04 fast, $08 
                                                                ;preload en.
  85                                                          ;@polarity8 -> (CCER)  $00 
                                                                ;active HI,$02 active low
  86                                                          ;@preload8  ->  $80 preload 
                                                                ;enable, CR1 content
  87                                   
  88                                   
  89  0080D7   AE000F                        LDW      X, #$000F     ;@presc16,  
  90  0080DA   89                            PUSHW    X
  91  0080DB   AE03FF                        LDW      X, #$03FF     ;@base16, -> base of counter, 
                                                                ;ARRL
  92  0080DE   89                            PUSHW    X
  93  0080DF   AE000F                        LDW      X, #$000f     ;@comp16, -> capture compare 
                                                                ;CCR1 content
  94  0080E2   89                            PUSHW    X
  95  0080E3   A660                          LD       A, #$60       ;@mode8,  -> (CCMR)PIN  
                                                                ;beheviavour: $10 active on 
                                                                ;match
  96  0080E5   88                            PUSH     A
  97  0080E6   A600                          LD       A, #$00       ;@polarity8 -> (CCER)  $00 
                                                                ;active HI,$02 active low
  98  0080E8   88                            PUSH     A
  99  0080E9   A600                          LD       A ,#$00       ;@preload8  ->  $80 preload 
                                                                ;enable, CR1 content
 100  0080EB   88                            PUSH     A             
 101  0080EC   CD819D                        call     tim1PwmCh2Setup
 102  0080EF   5B09                          ADDW     SP, #$09
 103  0080F1   AE000F                        LDW      X, #$000F     ;@presc16,  
 104  0080F4   89                            PUSHW    X
 105  0080F5   AE03FF                        LDW      X, #$03FF     ;@base16, -> base of counter, 
                                                                ;ARRL
 106  0080F8   89                            PUSHW    X
 107  0080F9   AE000F                        LDW      X, #$000f     ;@comp16, -> capture compare 
                                                                ;CCR1 content
 108  0080FC   89                            PUSHW    X
 109  0080FD   A660                          LD       A, #$60       ;@mode8,  -> (CCMR)PIN  
                                                                ;beheviavour: $10 active on 
                                                                ;match
 110  0080FF   88                            PUSH     A
 111  008100   A600                          LD       A, #$00       ;@polarity8 -> (CCER)  $00 
                                                                ;active HI,$02 active low
 112  008102   88                            PUSH     A
 113  008103   A600                          LD       A ,#$00       ;@preload8  ->  $80 preload 
                                                                ;enable, CR1 content
 114  008105   88                            PUSH     A             
 115  008106   CD81E9                        call     tim1PwmCh3Setup
 116  008109   5B09                          ADDW     SP, #$09
 117  00810B   AE000F                        LDW      X, #$000F     ;@presc16,  
 118  00810E   89                            PUSHW    X
 119  00810F   AE03FF                        LDW      X, #$03FF     ;@base16, -> base of counter, 
                                                                ;ARRL
 120  008112   89                            PUSHW    X
 121  008113   AE000F                        LDW      X, #$000f     ;@comp16, -> capture compare 
                                                                ;CCR1 content
 122  008116   89                            PUSHW    X
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 8  Assembler
                                               d:\stm8\dbg1\main.asm

 123  008117   A660                          LD       A, #$60       ;@mode8,  -> (CCMR)PIN  
                                                                ;beheviavour: $10 active on 
                                                                ;match
 124  008119   88                            PUSH     A
 125  00811A   A600                          LD       A, #$00       ;@polarity8 -> (CCER)  $00 
                                                                ;active HI,$02 active low
 126  00811C   88                            PUSH     A
 127  00811D   A600                          LD       A ,#$00       ;@preload8  ->  $80 preload 
                                                                ;enable, CR1 content
 128  00811F   88                            PUSH     A             
 129  008120   CD8234                        call     tim1PwmCh4Setup
 130  008123   5B09                          ADDW     SP, #$09
 131  008125   AE000F                        LDW      X, #$000F     ;@presc16,  
 132  008128   89                            PUSHW    X
 133  008129   AE03FF                        LDW      X, #$03FF     ;@base16, -> base of counter, 
                                                                ;ARRL
 134  00812C   89                            PUSHW    X
 135  00812D   AE000F                        LDW      X, #$000f     ;@comp16, -> capture compare 
                                                                ;CCR1 content
 136  008130   89                            PUSHW    X
 137  008131   A660                          LD       A, #$60       ;@mode8,  -> (CCMR)PIN  
                                                                ;beheviavour: $10 active on 
                                                                ;match
 138  008133   88                            PUSH     A
 139  008134   A600                          LD       A, #$00       ;@polarity8 -> (CCER)  $00 
                                                                ;active HI,$02 active low
 140  008136   88                            PUSH     A
 141  008137   A600                          LD       A ,#$00       ;@preload8  ->  $80 preload 
                                                                ;enable, CR1 content
 142  008139   88                            PUSH     A             
 143  00813A   CD8152                        call     tim1PwmCh1Setup
 144  00813D   5B09                          ADDW     SP, #$09
 145                                   
 146                                                          ;----ADC
 147  00813F   A606                          LD       A, #$06       ;@channel8, $00->AIN0, 
                                                                ;$01->AIN1, #$0F->AIN15
 148  008141   88                            PUSH     A
 149  008142   A600                          LD       A, #$00       ;@prescaler, $00->/2, $10->/3, 
                                                                ;$20->/4, $
 150  008144   88                            PUSH     A
 151  008145   CD829B                        CALL     adcSingleScanModeSetup
 152  008148   5B02                          ADDW     SP, #$02
 153                                                          ;---interrupt enable
 154  00814A   A601                          LD       A, #$01       ; UIE
 155  00814C   C75254                        LD       $5254, A
 156                         
 157                         
 158                         infinite_loop.l  
 159                                   
 160  00814F   8F                            wfi      
 161  008150   20FD                          jra      infinite_loop
 162                                   
 163                         
 164                                   
 165                         
 166                         ;------------------------------	
 167                         ;  _            _   
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 9  Assembler
                                               d:\stm8\dbg1\main.asm

 168                         ; | |_ ___  ___| |_ 
 169                         ; | __/ _ \/ __| __|
 170                         ; | ||  __/\__ \ |_ 
 171                         ;  \__\___||___/\__|
 172                         ;-------------------------------
 173                                                          ;--TEST PASSED!
 174                                                          ;===PROCEDURE 'tim1PwmCh1Setup'
 175                                                          ;@presc16,  
 176                                                          ;@base16, -> base of counter, 
                                                                ;ARRL
 177                                                          ;@comp16, -> pulse width, CCR1 
                                                                ;content
 178                                                          ;@mode8,  -> (CCMR) : $60 
                                                                ;PWM_MODE1
 179                                                          ;$70 iPWM_MODE2
 180                                                          ;additional:  $04 fast, $08 
                                                                ;preload en.
 181                                                          ;@polarity8 -> (CCER)  $00 
                                                                ;active HI,$02 active low
 182                                                          ;@preload8  ->  $80 preload 
                                                                ;enable, CR1 content
 183                                                          ; SP after RETURN +9
 184                                                          ;stack frame:
 185                                                          ;[v16a|return|prel|pol|mode|comp
                                                                ;|base|presc]
 186                         tim1PwmCh1Setup  
 187  008152   88                            PUSH     A
 188                                                          ;allocate memory
 189  008153   5201                          SUBW     SP, #$01      
 190                                                          ;-variables
 191  008155                                 #define  _006_v8a  $00 
 192  008155                                 #define  _006_prel $05
 193  008155                                 #define  _006_pol $06
 194  008155                                 #define  _006_mode $07
 195  008155                                 #define  _006_compH $08
 196  008155                                 #define  _006_compL $09
 197  008155                                 #define  _006_baseH $0A
 198  008155                                 #define  _006_baseL $0B
 199  008155                                 #define  _006_prescH $0C
 200  008155                                 #define  _006_prescL $0D
 201                                                          ;--disable timer
 202                                                          ;--disable timer
 203  008155   72115250                      BRES     $5250,#$00
 204                                                          ;--load comparand, Hi firstly
 205  008159   7B08                          LD       A, ($08,SP)
 206  00815B   C75265                        LD       $5265, A
 207  00815E   7B09                          LD       A, ($09,SP)
 208  008160   C75266                        LD       $5266, A
 209                                                          ;--prescaler high byte firstly
 210  008163   7B0C                          LD       A, ($0C,SP)
 211  008165   C75260                        LD       $5260, A      
 212  008168   7B0D                          LD       A, ($0D,SP)
 213  00816A   C75261                        LD       $5261, A
 214                                                          ;--load base, high byte first
 215  00816D   7B0A                          LD       A, ($0A,SP)
 216  00816F   C75262                        LD       $5262, A
 217  008172   7B0B                          LD       A, ($0B,SP)
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 10  Assembler
                                               d:\stm8\dbg1\main.asm

 218  008174   C75263                        LD       $5263, A
 219                                                          ;--load CCMR1
 220  008177   7B07                          LD       A, ($07,SP)
 221  008179   C75258                        LD       $5258, A
 222                                                          ;--polarity
 223                                                          ;--1) read and store 
 224                                                          ; content of another channels
 225  00817C   C6525C                        LD       A, $525C
 226  00817F   A4F0                          AND      A, #$F0
 227  008181   6B00                          LD       ($00,SP), A   ; store
 228                                                          ;--2)load data for loading in 
                                                                ;register
 229  008183   7B06                          LD       A, ($06,SP)
 230  008185   AA01                          OR       A, #$01       ; turn on channel 1
 231                                                          ;--3)apply others regs
 232  008187   1A00                          OR       A, ($00,SP)
 233  008189   C7525C                        LD       $525C, A
 234                                                          ;--turn on main channels
 235  00818C   721E526D                      BSET     $526D, #$07   ; MOE bit
 236                                                          ;--CR1
 237  008190   7B05                          LD       A, ($05,SP)
 238  008192   C75250                        LD       $5250, A
 239  008195   72105250                      BSET     $5250, #$00
 240                                                          ;free memory
 241  008199   5B01                          ADDW     SP, #$01
 242  00819B   84                            POP      A
 243  00819C   81                            RET      
 244                                   
 245                                   
 246                                                          ;--TEST PASSED!
 247                                                          ;===PROCEDURE 'tim1PwmCh2Setup'
 248                                                          ;@presc16,  
 249                                                          ;@base16, -> base of counter, 
                                                                ;ARRL
 250                                                          ;@comp16, ->  pulse width, CCR1 
                                                                ;content
 251                                                          ;@mode8,  -> (CCMR) : $60 
                                                                ;PWM_MODE1
 252                                                          ;$70 iPWM_MODE2
 253                                                          ;additional:  $04 fast, $08 
                                                                ;preload en.
 254                                                          ;@polarity8 -> (CCER)  $00 
                                                                ;active HI,$02 active low
 255                                                          ;@preload8  ->  $80 preload 
                                                                ;enable, CR1 content
 256                                                          ;SP after RETURN +9
 257                                                          ;stack frame:
 258                                                          ;[v16a|return|prel|pol|mode|comp
                                                                ;|base|presc]
 259                         tim1PwmCh2Setup  
 260  00819D   88                            PUSH     A
 261                                                          ;--allocate memory
 262  00819E   5201                          SUBW     SP , #$01
 263                                                          ;-variables
 264  0081A0                                 #define  _007_v8a $00
 265  0081A0                                 #define  _007_prel $05
 266  0081A0                                 #define  _007_pol $06
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 11  Assembler
                                               d:\stm8\dbg1\main.asm

 267  0081A0                                 #define  _007_mode $07
 268  0081A0                                 #define  _007_compH $08
 269  0081A0                                 #define  _007_compL $09
 270  0081A0                                 #define  _007_baseH $0A
 271  0081A0                                 #define  _007_baseL $0B
 272  0081A0                                 #define  _007_prescH $0C
 273  0081A0                                 #define  _007_prescL $0D
 274                                                          ;--disable timer
 275  0081A0   72115250                      BRES     $5250,#$00
 276                                                          ;--load comparand, Hi firstly
 277  0081A4   7B08                          LD       A, ($08,SP)
 278  0081A6   C75267                        LD       $5267, A
 279  0081A9   7B09                          LD       A, ($09,SP)
 280  0081AB   C75268                        LD       $5268, A
 281                                                          ;--prescaler high byte firstly
 282  0081AE   7B0C                          LD       A, ($0C,SP)
 283  0081B0   C75260                        LD       $5260, A      
 284  0081B3   7B0D                          LD       A, ($0D,SP)
 285  0081B5   C75261                        LD       $5261, A
 286                                                          ;--load base, high byte first
 287  0081B8   7B0A                          LD       A, ($0A,SP)
 288  0081BA   C75262                        LD       $5262, A
 289  0081BD   7B0B                          LD       A, ($0B,SP)
 290  0081BF   C75263                        LD       $5263, A
 291                                                          ;--load CCMR2
 292  0081C2   7B07                          LD       A, ($07,SP)
 293  0081C4   C75259                        LD       $5259, A
 294                                                          ;--polarity
 295                                                          ; 1)store content of another 
                                                                ;channels
 296  0081C7   C6525C                        LD       A, $525C
 297  0081CA   A40F                          AND      A, #$0F
 298  0081CC   6B00                          LD       ($00,SP), A   ; store
 299                                                          ;--2)load data for loading in 
                                                                ;register
 300  0081CE   7B06                          LD       A, ($06,SP)
 301  0081D0   AA01                          OR       A, #$01       ; turn on channel 
 302  0081D2   4E                            SWAP     A             ;  A << 4
 303                                                          ;--3) apply another regs
 304  0081D3   1A00                          OR       A, ($00,SP)
 305  0081D5   C7525C                        LD       $525C, A
 306                                                          ;--turn on main channels
 307  0081D8   721E526D                      BSET     $526D, #$07   ; MOE bit
 308                                                          ;--CR1
 309  0081DC   7B05                          LD       A, ($05,SP)
 310  0081DE   C75250                        LD       $5250, A
 311  0081E1   72105250                      BSET     $5250, #$00
 312                                                          ;--fre memory
 313  0081E5   5B01                          ADDW     SP, #$01
 314  0081E7   84                            POP      A
 315  0081E8   81                            RET      
 316                                   
 317                                                          ;--TEST PASSED!	 
 318                                                          ;===PROCEDURE 'tim1PwmCh3Setup'
 319                                                          ;@presc16,  
 320                                                          ;@base16, -> base of counter, 
                                                                ;ARRL
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 12  Assembler
                                               d:\stm8\dbg1\main.asm

 321                                                          ;@comp16, ->  pulse width, CCR1 
                                                                ;content
 322                                                          ;@mode8,  -> (CCMR) : $60 
                                                                ;PWM_MODE1
 323                                                          ;$70 iPWM_MODE2
 324                                                          ;additional:  $04 fast, $08 
                                                                ;preload en.
 325                                                          ;@polarity8 -> (CCER)  $00 
                                                                ;active HI,$02 active low
 326                                                          ;@preload8  ->  $80 preload 
                                                                ;enable, CR1 content
 327                                   
 328                                                          ;stack frame:
 329                                                          ;[v16a|return|prel|pol|mode|comp
                                                                ;|base|presc]
 330                         tim1PwmCh3Setup  
 331  0081E9   88                            PUSH     A
 332                                                          ;--allocate memory
 333  0081EA   5201                          SUBW     SP , #$01
 334                                                          ;-variables
 335  0081EC                                 #define  _008_v8a $00
 336  0081EC                                 #define  _008_prel $05
 337  0081EC                                 #define  _008_pol $06
 338  0081EC                                 #define  _008_mode $07
 339  0081EC                                 #define  _008_compH $08
 340  0081EC                                 #define  _008_compL $09
 341  0081EC                                 #define  _008_baseH $0A
 342  0081EC                                 #define  _008_baseL $0B
 343  0081EC                                 #define  _008_prescH $0C
 344  0081EC                                 #define  _008_prescL $0D
 345                                                          ;--disable timer
 346  0081EC   72115250                      BRES     $5250,#$00
 347                                                          ;--load comparand, Hi firstly
 348  0081F0   7B08                          LD       A, ($08,SP)
 349  0081F2   C75269                        LD       $5269, A
 350  0081F5   7B09                          LD       A, ($09,SP)
 351  0081F7   C7526A                        LD       $526A, A
 352                                                          ;--prescaler high byte firstly
 353  0081FA   7B0C                          LD       A, ($0C,SP)
 354  0081FC   C75260                        LD       $5260, A      
 355  0081FF   7B0D                          LD       A, ($0D,SP)
 356  008201   C75261                        LD       $5261, A
 357                                                          ;--load base, high byte first
 358  008204   7B0A                          LD       A, ($0A,SP)
 359  008206   C75262                        LD       $5262, A
 360  008209   7B0B                          LD       A, ($0B,SP)
 361  00820B   C75263                        LD       $5263, A
 362                                                          ;--load CCMR1
 363  00820E   7B07                          LD       A, ($07,SP)
 364  008210   C7525A                        LD       $525A, A
 365                                                          ;--polarity
 366                                                          ; 1)store content of another 
                                                                ;channels
 367  008213   C6525D                        LD       A, $525D
 368  008216   A4F0                          AND      A, #$F0
 369  008218   6B00                          LD       ($00,SP), A   ; store
 370                                                          ;--2)load data for loading in 
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 13  Assembler
                                               d:\stm8\dbg1\main.asm

                                                                ;register
 371  00821A   7B06                          LD       A, ($06,SP)
 372  00821C   AA01                          OR       A, #$01       ; turn on channel 
 373                                                          ;--3)apply another regs
 374  00821E   1A00                          OR       A, ($00,SP)
 375  008220   C7525D                        LD       $525D, A
 376                                                          ;--turn on main channels
 377  008223   721E526D                      BSET     $526D, #$07   ; MOE bit
 378                                                          ;--CR1
 379  008227   7B05                          LD       A, ($05,SP)
 380  008229   C75250                        LD       $5250, A
 381  00822C   72105250                      BSET     $5250, #$00
 382                                                          ;--free memory
 383  008230   5B01                          ADDW     SP, #$01
 384  008232   84                            POP      A
 385  008233   81                            RET      
 386                         
 387                                   
 388                                   
 389                                                          ;--TEST PASSED!	
 390                                                          ;===PROCEDURE 'tim1PwmCh4Setup'
 391                                                          ;@presc16,  
 392                                                          ;@base16, -> base of counter, 
                                                                ;ARRL
 393                                                          ;@comp16, ->  pulse width, CCR1 
                                                                ;content
 394                                                          ;@mode8,  -> (CCMR) : $60 
                                                                ;PWM_MODE1
 395                                                          ;$70 iPWM_MODE2
 396                                                          ;additional:  $04 fast, $08 
                                                                ;preload en.
 397                                                          ;@polarity8 -> (CCER)  $00 
                                                                ;active HI,$02 active low
 398                                                          ;@preload8  ->  $80 preload 
                                                                ;enable, CR1 content
 399                                   
 400                                                          ;stack frame:
 401                                                          ;[v16a|return|prel|pol|mode|comp
                                                                ;|base|presc]
 402                         tim1PwmCh4Setup  
 403  008234   88                            PUSH     A
 404                                                          ;--allocate memory
 405  008235   5201                          SUBW     SP , #$01
 406                                                          ;-variables
 407  008237                                 #define  _009_v8a $00
 408  008237                                 #define  _009_prel $05
 409  008237                                 #define  _009_pol $06
 410  008237                                 #define  _009_mode $07
 411  008237                                 #define  _009_compH $08
 412  008237                                 #define  _009_compL $09
 413  008237                                 #define  _009_baseH $0A
 414  008237                                 #define  _009_baseL $0B
 415  008237                                 #define  _009_prescH $0C
 416  008237                                 #define  _009_prescL $0D
 417                                                          ;--disable timer
 418  008237   72115250                      BRES     $5250,#$00
 419                                                          ;--load comparand, Hi firstly
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 14  Assembler
                                               d:\stm8\dbg1\main.asm

 420  00823B   7B08                          LD       A, ($08,SP)
 421  00823D   C7526B                        LD       $526B, A
 422  008240   7B09                          LD       A, ($09,SP)
 423  008242   C7526C                        LD       $526C, A
 424                                                          ;--prescaler high byte firstly
 425  008245   7B0C                          LD       A, ($0C,SP)
 426  008247   C75260                        LD       $5260, A      
 427  00824A   7B0D                          LD       A, ($0D,SP)
 428  00824C   C75261                        LD       $5261, A
 429                                                          ;--load base, high byte first
 430  00824F   7B0A                          LD       A, ($0A,SP)
 431  008251   C75262                        LD       $5262, A
 432  008254   7B0B                          LD       A, ($0B,SP)
 433  008256   C75263                        LD       $5263, A
 434                                                          ;--load CCMR
 435  008259   7B07                          LD       A, ($07,SP)
 436  00825B   C7525B                        LD       $525B, A
 437                                                          ;--polarity
 438                         ; 1)store content of another channels
 439  00825E   C6525D                        LD       A, $525D
 440  008261   A40F                          AND      A, #$0F
 441  008263   6B00                          LD       ($00,SP), A   ; store
 442                                                          ;--2)load data for loading in 
                                                                ;register
 443  008265   7B06                          LD       A, ($06,SP)
 444  008267   AA01                          OR       A, #$01       ; turn on channel 
 445  008269   4E                            SWAP     A             ;  A << 4
 446                                                          ;--3) apply another regs
 447  00826A   1A00                          OR       A,  ($00,SP)
 448  00826C   C7525D                        LD       $525D, A
 449                                                          ;--turn on main channels
 450  00826F   721E526D                      BSET     $526D, #$07   ; MOE bit
 451                                                          ;--CR1
 452  008273   7B05                          LD       A, ($05,SP)
 453  008275   C75250                        LD       $5250, A
 454  008278   72105250                      BSET     $5250, #$00
 455                                                          ;--free mem
 456  00827C   5B01                          ADDW     SP, #$01
 457  00827E   84                            POP      A
 458  00827F   81                            RET      
 459                                   
 460  008280                       startAdcSingleScan  MACRO    max_adc_ch
 461                                   LD       A, $5400
 462                                   AND      A, #$7F       ; clear EOC
 463                                   OR       A, max_adc_ch
 464                                   LD       $5400, A
 465                                   BSET     $5401, #$00
 466  008280                                 MEND     
 467                                   
 468                                                          ;---STM8 ADC initialization 
                                                                ;library
 469                         ;Author : Andrii Androsovych
 470                                                          ;====P R O C E D U R 
                                                                ;E===adcSingleModeSetup
 471                                                          ;@channel8, $00->AIN0, 
                                                                ;$01->AIN1, #$0F->AIN15
 472                                                          ;@prescaler, $00->/2, $10->/3, 
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 15  Assembler
                                               d:\stm8\dbg1\main.asm

                                                                ;$20->/4, $30->/6, $40->/8, 
                                                                ;$50->/10
 473                                                          ;ADC DATA is right aligned!
 474                                                          ;SP+2
 475                                                          ;----------
 476                                                          ;stack frame
 477                                                          ;[A|RET|prescaler|channel]
 478                         adcSingleModeSetup  
 479  008280                                 #define  _001_ch $05
 480  008280                                 #define  _001_presc $04
 481                                                          ;--store 
 482  008280   88                            PUSH     A
 483                                                          ;--disable ADC
 484  008281   72115401                      BRES     $5401, #$00
 485                                                          ;--load channel
 486  008285   7B05                          LD       A, ($05,SP)
 487  008287   A40F                          AND      A, #$0F
 488  008289   C75400                        LD       $5400, A
 489                                                          ;-result alignment- right
 490  00828C   72165402                      BSET     $5402, #$03   ; ALIGN bit
 491                                                          ;--prescaler
 492  008290   7B04                          LD       A, ($04,SP)
 493  008292   A4F0                          AND      A, #$F0
 494  008294   AA01                          OR       A, #$01       ; ADON
 495  008296   C75401                        LD       $5401, A
 496                                                          ;--restore
 497  008299   84                            POP      A
 498  00829A   81                            RET      
 499                                   
 500                                                          ;====P R O C E D U R 
                                                                ;E===adcSingleScanModeSetup,
 501                                                          ;@channel8, $00->AIN0, 
                                                                ;$01->AIN1, #$0F->AIN15
 502                                                          ;@prescaler, $00->/2, $10->/3, 
                                                                ;$20->/4, $30->/6, $40->/8, 
                                                                ;$50->/10
 503                                                          ;ADC DATA is right aligned!
 504                                                          ;SP+2
 505                                                          ;----------
 506                                                          ;stack frame
 507                                                          ;[A|RET|prescaler|channel]
 508                                                          ;--NOTE: result stores in 
                                                                ;ADC_DBxRH, ADC_DBxRL
 509                         adcSingleScanModeSetup  
 510  00829B                                 #define  $05 $05
 511  00829B                                 #define  $04 $04
 512                                                          ;--store 
 513  00829B   88                            PUSH     A
 514                                                          ;--disable ADC
 515  00829C   72115401                      BRES     $5401, #$00
 516                                                          ;--load channel
 517  0082A0   7B05                          LD       A, ($05,SP)
 518  0082A2   A40F                          AND      A, #$0F
 519  0082A4   C75400                        LD       $5400, A
 520                                                          ;- right alignment  scan
 521  0082A7   72165402                      BSET     $5402, #$03   ; ALIGN bit
 522  0082AB   72125402                      BSET     $5402, #$01   ; SCAN bit
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 16  Assembler
                                               d:\stm8\dbg1\main.asm

 523                                                          ;--prescaler
 524  0082AF   7B04                          LD       A, ($04,SP)
 525  0082B1   A4F0                          AND      A, #$F0
 526  0082B3   AA01                          OR       A, #$01       ; ADON
 527  0082B5   C75401                        LD       $5401, A
 528  0082B8   72105401                      BSET     $5401, #$00   ; start
 529                                                          ;--restore
 530  0082BC   84                            POP      A
 531  0082BD   81                            RET      
 532                                   
 533                                                          ;====P R O C E D U R E===turn on
                                                                ; clk bus
 534                                                          ;@peripherial8
 535                                                          ;TIM1-$80,TIM3-$40,TIM2/5-$20,TI
                                                                ;M4/6-$10,UART-see datasheet,
 536                                                          ;SPI-$2,I2C-1
 537                                                          ;STACK after return +1
 538                         clkBusPeripherial1  
 539  0082BE   88                            PUSH     A
 540  0082BF   7B04                          LD       A, ($04,SP)
 541  0082C1   C750C7                        LD       $50C7, A
 542  0082C4   84                            POP      A
 543  0082C5   81                            RET      
 544                                                          ;====P R O C E D U R E===turn on
                                                                ; clk bus
 545                                                          ;@peripherial8
 546                                                          ;CAN-$80, ADC-$08, AWU-$04
 547                                                          ;STACK after return +1
 548                         clkBusPeripherial2  
 549  0082C6   88                            PUSH     A
 550  0082C7   7B04                          LD       A, ($04,SP)
 551  0082C9   C750CA                        LD       $50CA, A
 552  0082CC   84                            POP      A
 553  0082CD   81                            RET      
 554                                                          ;===P R O C E D U R E=switch to 
                                                                ;Crystal
 555                                                          ;--NO PARAMS
 556                                                          ;STACK after return 0
 557                         clkSwitchToCrystal  
 558  0082CE   88                            PUSH     A
 559                                                          ;--tuurn on HSE oscillator
 560  0082CF   A601                          LD       A, #$01
 561  0082D1   C750C1                        LD       $50C1, A
 562                         clkSwitchToCrystal_hsi_rdy  
 563                                                          ;--wait until crystal oscillator
                                                                ; ready (HSERDY)
 564  0082D4   720350C1FB                    BTJF     $50C1, #$01, clkSwitchToCrystal_hsi_rdy
 565                                                          ;---Enable the switching 
                                                                ;mechanism
 566  0082D9   C650C5                        LD       A, $50C5
 567  0082DC   AA02                          OR       A, #$02
 568  0082DE   C750C5                        LD       $50C5, A
 569                                                          ;---select source clock
 570                                                          ;0xE1: HSI selected as master 
                                                                ;clock source (reset value)
 571                                                          ;0xD2: LSI selected as master 
                                                                ;clock source (only if LSI_EN
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 17  Assembler
                                               d:\stm8\dbg1\main.asm

 572                                                          ;option bit is set)
 573                                                          ;0xB4: HSE selected as master 
                                                                ;clock source
 574  0082E1   A6B4                          LD       A, #$B4
 575  0082E3   C750C4                        LD       $50C4, A
 576  0082E6   9D                            NOP      
 577  0082E7   9D                            NOP      
 578  0082E8   9D                            NOP      
 579  0082E9   9D                            NOP      
 580  0082EA   84                            POP      A
 581  0082EB   81                            RET      
 582                                   
 583                                   
 584                                                          ;==P R O C E D U R E=="set HSI 
                                                                ;divider"
 585                                                          ;--@ char divider
 586                                                          ;STACK after return +1
 587                         clkSetHsiDivider  
 588                                                          ;--store registers A,X,Y,CC 
                                                                ;(1+2+2+1=6Bytes)
 589  0082EC   88                            PUSH     A
 590                                                          ;-read default value 
 591  0082ED   C650C6                        LD       A, $50C6
 592                                                          ;---clear all the hsi divider 
                                                                ;bits
 593  0082F0   A4E7                          AND      A, #$E7
 594                                                          ;--1st paprameter has offset 9 
                                                                ;bytes
 595                                                          ; because A,X,Y,CC,SP has ben 
                                                                ;stored later 
 596  0082F2   1A04                          OR       A, ($04,SP)
 597                                                          ;---update CLK_CKDIVR
 598  0082F4   C750C6                        LD       $50C6, A
 599                                                          ;--restore registers
 600  0082F7   84                            POP      A
 601  0082F8   81                            RET      
 602                                   
 603                                                          ;======P R O C e D U R E==="set 
                                                                ;CPU divider"
 604                                                          ;@ char divider 
 605                                                          ;STACK after return +1
 606                         clkSetCpuDivider  
 607                                                          ;--store registers A,X,Y,CC 
                                                                ;(1+2+2+1=6Bytes)
 608  0082F9   88                            PUSH     A
 609                                                          ;-read default value 
 610  0082FA   C650C6                        LD       A, $50C6
 611                                                          ;---clear all the hsi divider 
                                                                ;bits
 612  0082FD   A4F8                          AND      A, #$f8
 613                                                          ;--1st paprameter has offset 9 
                                                                ;bytes
 614                                                          ; because A,X,Y,CC,SP has ben 
                                                                ;stored later
 615  0082FF   1A04                          OR       A, ($04,SP)
 616                                                          ;---update CLK_CKDIVR
 617  008301   C750C6                        LD       $50C6, A
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 18  Assembler
                                               d:\stm8\dbg1\main.asm

 618                                                          ;--restore registers
 619  008304   84                            POP      A
 620  008305   81                            RET      
 621                                   
 622                                   
 623                                   
 624                         ;------I  S  R----------
 625                         
 626                         tim4Isr   
 627                                                          ;--clear flag
 628  008306   72115344                      BRES     $5344, #$00
 629  00830A   901C500A                      BCPL     $500A, #$06
 630  00830E   80                            IRET     
 631                                   
 632                                   
 633                                   
 634                         onTim1Update  
 635                                                          ;--clear flag
 636  00830F   A600                          LD       A, #$00
 637  008311   C75255                        LD       $5255, A
 638                                                          ;--load ADC To PWM register
 639                                                          ;;AIN 3, 4,5,6
 640  008314   C653E6                        LD       A, $53E6
 641  008317   C75265                        LD       $5265, A
 642  00831A   C653E7                        LD       A, $53E7
 643  00831D   C75266                        LD       $5266, A
 644                                                          ;--4
 645  008320   C653E8                        LD       A, $53E8
 646  008323   C75267                        LD       $5267, A
 647  008326   C653E9                        LD       A, $53E9
 648  008329   C75268                        LD       $5268, A
 649                                                          ;--5
 650  00832C   C653EA                        LD       A, $53EA
 651  00832F   C75269                        LD       $5269, A
 652  008332   C653EB                        LD       A, $53EB
 653  008335   C7526A                        LD       $526A, A
 654                                                          ;--6
 655  008338   C653EC                        LD       A, $53EC
 656  00833B   C7526B                        LD       $526B, A
 657  00833E   C653ED                        LD       A, $53ED
 658  008341   C7526C                        LD       $526C, A
 659                                                          ;--start ADC
 660                                   startAdcSingleScan #$06
 660  008344   C65400                        LD       A, $5400
 660  008347   A47F                          AND      A, #$7F       ; clear EOC
 660  008349   AA06                          OR       A, #$06
 660  00834B   C75400                        LD       $5400, A
 660  00834E   72105401                      BSET     $5401, #$00
 661  008352                                 
 662  008352   80                            IRET     
 663                         
 664  008353                                 interrupt NonHandledInterrupt
 665                         NonHandledInterrupt.l  
 666  008353   80                            iret     
 667                                   segment  'vectit'
 668  008000   82008080                      dc.l     {$82000000+main}  ; reset
 669  008004   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; trap
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 19  Assembler
                                               d:\stm8\dbg1\main.asm

 670  008008   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq0
 671  00800C   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq1
 672  008010   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq2
 673  008014   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq3
 674  008018   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq4
 675  00801C   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq5
 676  008020   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq6
 677  008024   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq7
 678  008028   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq8
 679  00802C   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq9
 680  008030   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq10
 681  008034   8200830F                      dc.l     {$82000000+onTim1Update}  ; irq11
 682  008038   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq12
 683  00803C   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq13
 684  008040   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq14
 685  008044   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq15
 686  008048   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq16
 687  00804C   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq17
 688  008050   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq18
 689  008054   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq19
 690  008058   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq20
 691  00805C   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq21
 692  008060   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq22
 693  008064   82008306                      dc.l     {$82000000+tim4Isr}  ; irq23
 694  008068   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq24
 695  00806C   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq25
 696  008070   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq26
 697  008074   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq27
 698  008078   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq28
 699  00807C   82008353                      dc.l     {$82000000+NonHandledInterrupt}  ; irq29
 700                         
 701  008080                                 end      
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Mon Aug 26 18:38:51 2024
Page 20  Assembler
                                               d:\stm8\dbg1\main.asm

Symbol Name                       Value     Call       Type  Scope      Rel.  Line  Privacy  Segment   Size  Bytes File

NonHandledInterrupt               00008353  interrupt  LONG  Internal   ABS    665  private  text         1     0  -

adcSingleModeSetup                    8280         no  WORD  Internal   ABS    478  private  text        27     0  -
adcSingleScanModeSetup                829B         no  WORD  Internal   ABS    509  private  text        35     0  -

clear_ram0                        00008087         no  LONG  Internal   ABS     17  private  text        10     0  -
clear_ram1                        00008091         no  LONG  Internal   ABS     29  private  text        10     0  -
clear_stack                       0000809B         no  LONG  Internal   ABS     40  private  text       180     0  -
clkBusPeripherial1                    82BE         no  WORD  Internal   ABS    538  private  text         8     0  -
clkBusPeripherial2                    82C6         no  WORD  Internal   ABS    548  private  text         8     0  -
clkSwitchToCrystal                    82CE         no  WORD  Internal   ABS    557  private  text         6     0  -
clkSwitchToCrystal_hsi_rdy            82D4         no  WORD  Internal   ABS    562  private  text        24     0  -
clkSetHsiDivider                      82EC         no  WORD  Internal   ABS    587  private  text        13     0  -
clkSetCpuDivider                      82F9         no  WORD  Internal   ABS    606  private  text        13     0  -

infinite_loop                     0000814F         no  LONG  Internal   ABS    158  private  text         3     0  -

main                              00008080         no  LONG  Internal   ABS      7  private  text         7     0  -

onTim1Update                          830F         no  WORD  Internal   ABS    634  private  text        68     0  -

ram0_start                              00         no  BYTE  Internal   ABS     14  private  text         0     0  -
ram0_end                                FF         no  BYTE  Internal   ABS     15  private  text         0     0  -
ram1_start                            0100         no  WORD  Internal   ABS     26  private  text         0     0  -
ram1_end                              01FF         no  WORD  Internal   ABS     27  private  text         0     0  -

stack_start                           0200         no  WORD  Internal   ABS     37  private  text         0     0  -
stack_end                             03FF         no  WORD  Internal   ABS     38  private  text         0     0  -

tim1PwmCh1Setup                       8152         no  WORD  Internal   ABS    186  private  text        75     0  -
tim1PwmCh2Setup                       819D         no  WORD  Internal   ABS    259  private  text        76     0  -
tim1PwmCh3Setup                       81E9         no  WORD  Internal   ABS    330  private  text        75     0  -
tim1PwmCh4Setup                       8234         no  WORD  Internal   ABS    402  private  text        76     0  -
tim4Isr                               8306         no  WORD  Internal   ABS    626  private  text         9     0  -


26 labels
No errors on assembly of 'd:\stm8\dbg1\main.asm'